name: Build ESP8266 Offline Docker Image

on:

  workflow_dispatch:

jobs:
  build-image:
    runs-on: ubuntu-latest

    permissions:
      contents: read
      packages: write

    steps:
      - name: üì• Checkout repository
        uses: actions/checkout@v4

      - name: üê≥ Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: üîë Log in to GitHub Container Registry
        uses: docker/login-action@v3
        with:
          registry: ghcr.io
          username: ${{ github.actor }}
          password: ${{ secrets.GHCR_PAT }}

      - name: üè∑ Build and push Docker image
        run: |
          # –ü—Ä–∏–≤–æ–¥–∏–º –∏–º—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É, —á—Ç–æ–±—ã Docker –ø—Ä–∏–Ω—è–ª —Ç–µ–≥
          IMAGE=ghcr.io/$(echo "${GITHUB_REPOSITORY}" | tr '[:upper:]' '[:lower:]'):latest
          echo "Building and pushing Docker image: $IMAGE"
          docker buildx build \
            --iidfile build-iid.txt \
            --push \
            -t $IMAGE \
            .
